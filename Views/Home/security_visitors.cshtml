@{
    ViewData["Title"] = "Security and Visitors";
}
<head>
	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->
	<link rel="stylesheet" href="~/css/security_visitors.css" asp-append-version="true">
	<link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true">
	<!-- Add Toastr for notifications -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
	<style>
        @@media screen and (max-width: 1200px) {
            .security-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .requests-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .head-title {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        @@media screen and (max-width: 768px) {
            #sidebar {
                width: 60px;
            }
            
            #sidebar .brand .text,
            #sidebar .side-menu li a .text {
                display: none;
            }
            
            #content {
                width: calc(100% - 60px);
                left: 60px;
            }
            
            .security-card {
                padding: 15px;
            }
            
            .emergency-list {
                grid-template-columns: 1fr;
            }
            
            .visitor-list, .vehicle-list {
                grid-template-columns: 1fr;
            }
            
            .head-title h1 {
                font-size: 24px;
            }
            
            .breadcrumb {
                flex-wrap: wrap;
            }
        }
        
        @@media screen and (max-width: 576px) {
            #content nav .form-input {
                display: none;
            }
            
            #content nav .form-input.show {
                display: block;
                width: 100%;
                position: absolute;
                top: 100%;
                left: 0;
                padding: 10px;
                background: var(--light);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                z-index: 100;
            }
            
            .head-title {
                padding: 15px;
            }
            
            .security-card {
                padding: 10px;
            }
            
            .emergency-contact {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .contact-icon {
                margin-bottom: 10px;
            }
            
            .list-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .request-info {
                margin-bottom: 10px;
            }
            
            .status-badge {
                align-self: flex-start;
            }
        }
	</style>
</head>

<title>Security and Visitors</title>
<body>


	<!-- SIDEBAR -->
		<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">Welcome</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a asp-area="" asp-controller="Home" asp-action="dashboard">
					<i class='bx bxs-dashboard'></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="profile">
					<i class='bx bxs-user'></i>
					<span class="text">Profile</span>
				</a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="Announcements">
					<i class='bx bxs-megaphone'></i>
					<span class="text">Announcement</span>
				</a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="billing">
					<i class='bx bxs-credit-card-front'></i>
					<span class="text">Payment and Billing</span>
				</a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="facility_reservation">
					<i class='bx bxs-credit-card-front'></i>
					<span class="text">Facility Reservation</span>
				</a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="Services">
                    <i class='bx bxs-briefcase'></i>
                    <span class="text">Services</span>
                </a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="Community_forum">
                    <i class='bx bxs-message-square-dots'></i>
                    <span class="text">Community Forum</span>
                </a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="security_visitors">
					<i class='bx bxs-shield-alt-2'></i>
					<span class="text">Security and Visitors</span>
				</a>
			</li>
			<li>
				<a asp-area="" asp-controller="Home" asp-action="contact">
					<i class='bx bx-support'></i>
					<span class="text">Contact and Support</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class='bx bxs-cog'></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a asp-action="logout" class="logout">
					<i class='bx bxs-log-out-circle'></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->
	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' id="menuBar"></i>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a>
			<a asp-area="" asp-controller="Home" asp-action="profile">
				<img src="~/images/profile.jpg" style="border-radius: 50%; width: 36px; height: 36px; object-fit: cover;">
			</a>
		</nav>
		<!-- NAVBAR -->
		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Security and Visitors</h1>
					<ul class="breadcrumb">
						<li>
							<a asp-area="" asp-controller="Home" asp-action="dashboard">Home</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" asp-area="" asp-controller="Home" asp-action="security_visitors">Security and Visitors</a>
						</li>
					</ul>
				</div>
			</div>

			<div class="security-section">
				<!-- VISITOR PASS REQUEST -->
				<div class="security-card">
					<h2><i class='bx bx-user-plus'></i>Visitor Pass Request</h2>
					<form id="visitorPassForm">
						@Html.AntiForgeryToken()
						<div class="form-group">
							<label for="visitorName">Visitor Name</label>
							<input type="text" id="visitorName" name="visitorName" required placeholder="Enter visitor's name">
						</div>
						<div class="form-group">
							<label for="visitDate">Visit Date</label>
							<input type="date" id="visitDate" name="visitDate" required min="@DateTime.Now.ToString("yyyy-MM-dd")">
						</div>
						<div class="form-group">
							<label for="visitPurpose">Purpose of Visit</label>
							<textarea id="visitPurpose" name="purpose" required placeholder="Enter purpose of visit"></textarea>
						</div>
						<button type="submit" class="btn-submit">Request Pass</button>
					</form>
				</div>

				<!-- VEHICLE REGISTRATION -->
				<div class="security-card">
					<h2><i class='bx bx-car'></i>Vehicle Registration</h2>
					<form id="vehicleRegistrationForm">
						@Html.AntiForgeryToken()
						<div class="form-group">
							<label for="vehicleMake">Vehicle Make</label>
							<input type="text" id="vehicleMake" name="vehicleMake" required placeholder="Enter vehicle make">
						</div>
						<div class="form-group">
							<label for="vehicleModel">Vehicle Model</label>
							<input type="text" id="vehicleModel" name="vehicleModel" required placeholder="Enter vehicle model">
						</div>
						<div class="form-group">
							<label for="plateNumber">Plate Number</label>
							<input type="text" id="plateNumber" name="plateNumber" required placeholder="Enter plate number">
						</div>
						<button type="submit" class="btn-submit">Register Vehicle</button>
					</form>
				</div>

				<!-- EMERGENCY CONTACTS -->
				<div class="security-card">
					<h2><i class='bx bx-phone-call'></i>Emergency Contacts</h2>
					<div class="emergency-list">
						<div class="emergency-contact">
							<div class="contact-icon">
								<i class='bx bx-building-house'></i>
							</div>
							<div class="contact-info">
								<h3>Security Office</h3>
								<p>+1 (555) 123-4567</p>
							</div>
						</div>
						<div class="emergency-contact">
							<div class="contact-icon">
								<i class='bx bx-first-aid'></i>
							</div>
							<div class="contact-info">
								<h3>Medical Emergency</h3>
								<p>911</p>
							</div>
						</div>
						<div class="emergency-contact">
							<div class="contact-icon">
								<i class='bx bx-shield-quarter'></i>
							</div>
							<div class="contact-info">
								<h3>Police Department</h3>
								<p>+1 (555) 987-6543</p>
							</div>
						</div>
						<div class="emergency-contact">
							<div class="contact-icon">
								<i class='bx bx-water'></i>
							</div>
							<div class="contact-info">
								<h3>Fire Department</h3>
								<p>911</p>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- REQUESTS AND REGISTRATIONS -->
			<div class="requests-section">
				<!-- VISITOR PASS REQUESTS -->
				<div class="security-card">
					<h2><i class='bx bx-list-ul'></i>Visitor Pass Requests</h2>
					<div class="requests-container">
						<h3>Pending Requests</h3>
						<div id="pendingVisitorPasses" class="visitor-list">
							<!-- Dynamically populated -->
						</div>

						<h3>Approved Requests</h3>
						<div id="approvedVisitorPasses" class="visitor-list">
							<!-- Dynamically populated -->
						</div>
					</div>
				</div>

				<!-- VEHICLE REGISTRATIONS -->
				<div class="security-card">
					<h2><i class='bx bx-car'></i>Vehicle Registrations</h2>
					<div class="requests-container">
						<h3>Pending Registrations</h3>
						<div id="pendingVehicleRegistrations" class="vehicle-list">
							<!-- Dynamically populated -->
						</div>

						<h3>Approved Registrations</h3>
						<div id="approvedVehicleRegistrations" class="vehicle-list">
							<!-- Dynamically populated -->
						</div>
					</div>
				</div>
			</div>
		</main>
		<!-- MAIN -->
	</section>

	<!-- Add jQuery and Toastr -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

	<script>
		$(document).ready(function() {
			// Configure toastr
			toastr.options = {
				"closeButton": true,
				"progressBar": true,
				"positionClass": "toast-top-right",
			};

			// Handle visitor pass form submission
			$('#visitorPassForm').on('submit', function(e) {
				e.preventDefault();
				const formData = {
					visitorName: $('#visitorName').val(),
					visitDate: $('#visitDate').val(),
					purpose: $('#visitPurpose').val()
				};

				$.ajax({
					url: '/Home/RequestVisitorPass',
					type: 'POST',
					contentType: 'application/json',
					data: JSON.stringify(formData),
					headers: {
						'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
					},
					success: function(response) {
						if (response.success) {
							toastr.success(response.message);
							$('#visitorPassForm')[0].reset();
							loadVisitorPasses();
						} else {
							toastr.error(response.message || 'An error occurred');
						}
					},
					error: function(xhr) {
						console.error('Error:', xhr);
						toastr.error('An error occurred while submitting the visitor pass request.');
					}
				});
			});

			// Handle vehicle registration form submission
			$('#vehicleRegistrationForm').on('submit', function(e) {
				e.preventDefault();
				const formData = {
					vehicleMake: $('#vehicleMake').val(),
					vehicleModel: $('#vehicleModel').val(),
					plateNumber: $('#plateNumber').val()
				};

				$.ajax({
					url: '/Home/RegisterVehicle',
					type: 'POST',
					contentType: 'application/json',
					data: JSON.stringify(formData),
					headers: {
						'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
					},
					success: function(response) {
						if (response.success) {
							toastr.success(response.message);
							$('#vehicleRegistrationForm')[0].reset();
							loadVehicleRegistrations();
						} else {
							toastr.error(response.message || 'An error occurred');
						}
					},
					error: function(xhr) {
						console.error('Error:', xhr);
						toastr.error('An error occurred while submitting the vehicle registration.');
					}
				});
			});

			// Load visitor passes
			function loadVisitorPasses() {
				$.get('/Home/GetVisitorPasses')
					.done(function(data) {
						$('#pendingVisitorPasses').empty();
						$('#approvedVisitorPasses').empty();

						data.forEach(function(pass) {
							const html = `
								<div class="list-item">
									<div class="request-info">
										<span class="visitor-name">${pass.visitorName}</span>
										<span class="visit-date">${pass.visitDate}</span>
										<span class="purpose">${pass.purpose}</span>
									</div>
									<div class="status-badge status-${pass.status.toLowerCase()}">${pass.status}</div>
								</div>
							`;
							if (pass.status === 'Pending') {
								$('#pendingVisitorPasses').append(html);
							} else if (pass.status === 'Approved') {
								$('#approvedVisitorPasses').append(html);
							}
						});
					})
					.fail(function(xhr) {
						console.error('Error loading visitor passes:', xhr);
						toastr.error('Failed to load visitor passes');
					});
			}

			// Load vehicle registrations
			function loadVehicleRegistrations() {
				$.get('/Home/GetVehicleRegistrations')
					.done(function(data) {
						$('#pendingVehicleRegistrations').empty();
						$('#approvedVehicleRegistrations').empty();

						data.forEach(function(reg) {
							const html = `
								<div class="list-item">
									<div class="request-info">
										<span class="vehicle-make">${reg.vehicleMake}</span>
										<span class="vehicle-model">${reg.vehicleModel}</span>
										<span class="plate-number">${reg.plateNumber}</span>
									</div>
									<div class="status-badge status-${reg.status.toLowerCase()}">${reg.status}</div>
								</div>
							`;
							if (reg.status === 'Pending') {
								$('#pendingVehicleRegistrations').append(html);
							} else if (reg.status === 'Approved') {
								$('#approvedVehicleRegistrations').append(html);
							}
						});
					})
					.fail(function(xhr) {
						console.error('Error loading vehicle registrations:', xhr);
						toastr.error('Failed to load vehicle registrations');
					});
			}

			// Initialize
			loadVisitorPasses();
			loadVehicleRegistrations();

			// Handle sidebar toggle
			$('#menuBar').on('click', function() {
				$('#sidebar').toggleClass('hide');
			});

			// Handle dark mode toggle
			$('#switch-mode').on('change', function() {
				$('body').toggleClass('dark', this.checked);
			});
		});
	</script>
</body>